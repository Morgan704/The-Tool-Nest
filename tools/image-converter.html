<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Image Converter — Nest</title>
<link rel="stylesheet" href="../assets/styles.css"/>
<style>.tool-center{max-width:820px;margin:80px auto;padding:20px}.preview-img{max-width:320px;border-radius:8px}</style>
</head>
<body>
  <div class="tool-center tool-wrap">
    <a href="../index.html">← Home</a>
    <h1>Image Converter & Resizer</h1>
    <p class="kv">Upload an image, choose format and size. Conversion uses canvas in-browser.</p>

    <input id="file" type="file" accept="image/*" />
    <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
      <label class="kv">Format</label>
      <select id="format" class="input" style="width:120px">
        <option value="image/webp">WebP</option>
        <option value="image/png">PNG</option>
        <option value="image/jpeg">JPG</option>
      </select>
      <label class="kv">Max longest side</label>
      <select id="size" class="input" style="width:120px"><option value="0">Original</option><option value="1080">1080</option><option value="720">720</option><option value="480">480</option></select>
      <button id="convert" class="btn btn-primary">Convert</button>
      <button id="reset" class="btn btn-secondary">Reset</button>
    </div>

    <div id="out" style="margin-top:16px"></div>
    <div style="margin-top:10px"><button id="download" class="btn btn-primary" disabled>Download</button></div>
  </div>

<script>
const fileInput = document.getElementById('file');
const fmt = document.getElementById('format');
const sizeSel = document.getElementById('size');
const convertBtn = document.getElementById('convert');
const resetBtn = document.getElementById('reset');
const outDiv = document.getElementById('out');
const dl = document.getElementById('download');
let blobUrl = '';

function clearOut(){ outDiv.innerHTML=''; dl.disabled=true; if(blobUrl){ URL.revokeObjectURL(blobUrl); blobUrl=''; } }

resetBtn.addEventListener('click', ()=>{ fileInput.value=''; clearOut(); });

convertBtn.addEventListener('click', async ()=>{
  const file = fileInput.files[0]; if(!file){ alert('Select an image'); return; }
  const img = new Image(); const url = URL.createObjectURL(file);
  img.src = url; await img.decode();
  let w = img.width, h = img.height;
  const maxSide = parseInt(sizeSel.value,10);
  if(maxSide>0 && Math.max(w,h) > maxSide){
    if(w >= h){ h = Math.round(h * (maxSide / w)); w = maxSide; } else { w = Math.round(w * (maxSide / h)); h = maxSide; }
  }
  const canvas = document.createElement('canvas'); canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d'); ctx.drawImage(img,0,0,w,h);
  
});
</script>
</body>const mime = fmt.value;
canvas.toBlob((b)=>{
  if(!b){ alert('Conversion failed'); return; }
  clearOut();
  blobUrl = URL.createObjectURL(b);

  // Get file size in KB
  const fileSizeKB = (b.size / 1024).toFixed(1);
  const ext = mime === 'image/jpeg' ? 'JPG' : mime.split('/')[1].toUpperCase();

  outDiv.innerHTML = `
    <img class="preview-img" src="${blobUrl}" alt="converted preview">
    <p>Converted to: <strong>${ext}</strong> — ${w}×${h}px — ${fileSizeKB} KB</p>
  `;

  dl.disabled = false;
  dl.onclick = ()=>{
    const a = document.createElement('a');
    a.href = blobUrl;
    a.download = 'converted.' + (ext.toLowerCase());
    a.click();
  };

  URL.revokeObjectURL(url);
}, mime, 0.92);

</html>
