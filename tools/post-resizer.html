<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Post Resizer — Nest</title>
  <link rel="stylesheet" href="../assets/styles.css"/>
  <style>
    body{font-family:Arial, sans-serif; background:#f9f9f9; margin:0}
    .wrap{max-width:1000px; margin:60px auto; padding:20px}
    .card{background:#fff; border-radius:14px; padding:24px; box-shadow:0 8px 24px rgba(0,0,0,.08)}
    h1{margin:0 0 10px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:20px}
    .controls{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; align-items:end}
    label{font-weight:600; font-size:14px}
    input[type="file"], select, input[type="range"]{width:100%}
    .stage{display:flex; align-items:center; justify-content:center; background:#f3f5f9; border:1px dashed #cfd6e4; border-radius:12px; min-height:360px; position:relative}
    canvas{max-width:100%; border-radius:10px}
    .btn{padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:700}
    .btn-primary{background:#007bff; color:#fff}
    .btn-secondary{background:#e9eef7}
    .meta{font-size:13px; color:#555; margin-top:8px}
    .hint{font-size:12px; color:#777}
    .stack{display:flex; gap:10px; flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <a href="../index.html">← Home</a>
    <div class="card" style="margin-top:12px">
      <h1>Post Resizer (Pro)</h1>
      <p>Resize and crop for Instagram, Twitter/X, Facebook, LinkedIn, YouTube, and Stories — all in your browser.</p>

      <div class="controls">
        <div>
          <label>Upload Image</label>
          <input id="file" type="file" accept="image/*">
        </div>
        <div>
          <label>Preset</label>
          <select id="preset">
            <option value="1080x1080">Instagram Square — 1080×1080</option>
            <option value="1080x1350">Instagram Portrait — 1080×1350</option>
            <option value="1080x1920">Instagram Story — 1080×1920</option>
            <option value="1200x675">Twitter/X — 1200×675</option>
            <option value="1200x630">Facebook — 1200×630</option>
            <option value="1200x627">LinkedIn — 1200×627</option>
            <option value="1280x720">YouTube Thumb — 1280×720</option>
          </select>
        </div>
        <div>
          <label>Format</label>
          <select id="format">
            <option value="image/jpeg">JPG</option>
            <option value="image/png">PNG</option>
          </select>
        </div>
        <div>
          <label>Zoom <span class="hint">(drag to zoom in)</span></label>
          <input id="zoom" type="range" min="1" max="3" step="0.01" value="1">
        </div>
        <div>
          <label>Pan X <span class="hint">(- ← → +)</span></label>
          <input id="panX" type="range" min="-100" max="100" step="1" value="0">
        </div>
        <div>
          <label>Pan Y <span class="hint">(- ↑ ↓ +)</span></label>
          <input id="panY" type="range" min="-100" max="100" step="1" value="0">
        </div>
        <div class="stack">
          <button id="fit" class="btn btn-secondary">Auto Fit</button>
          <button id="download" class="btn btn-primary" disabled>Download</button>
        </div>
      </div>

      <div class="row" style="margin-top:16px">
        <div class="stage">
          <canvas id="preview"></canvas>
        </div>
        <div class="card">
          <h3 style="margin-top:0">Instructions</h3>
          <ol>
            <li>Upload an image.</li>
            <li>Choose a <strong>Preset</strong> (e.g., Instagram Story).</li>
            <li>Use <strong>Zoom</strong> and <strong>Pan</strong> to position.</li>
            <li>Click <strong>Download</strong> to save the final image.</li>
          </ol>
          <p class="meta" id="info">No image loaded.</p>
        </div>
      </div>
    </div>
  </div>

<script>
const fileInput = document.getElementById('file');
const presetSel = document.getElementById('preset');
const formatSel = document.getElementById('format');
const zoomRange = document.getElementById('zoom');
const panXRange = document.getElementById('panX');
const panYRange = document.getElementById('panY');
const fitBtn = document.getElementById('fit');
const downloadBtn = document.getElementById('download');
const info = document.getElementById('info');
const canvas = document.getElementById('preview');
const ctx = canvas.getContext('2d', { alpha: false });

let img = null, imgURL = '', imgW = 0, imgH = 0;
let targetW = 1080, targetH = 1080;
let baseScale = 1;   // minimum to cover
let zoom = 1;        // user zoom multiplier
let panX = 0, panY = 0; // -100..100 sliders

function parsePreset() {
  const [w,h] = presetSel.value.split('x').map(n=>parseInt(n,10));
  targetW = w; targetH = h;
  canvas.width = targetW;
  canvas.height = targetH;
}

function updateBaseScale(){
  if(!img) return;
  const scaleW = targetW / imgW;
  const scaleH = targetH / imgH;
  baseScale = Math.max(scaleW, scaleH); // cover
}

function sliderToOffset(pxExtra){
  // pan sliders map -100..100 to pixel offset range of the "extra" area beyond cover
  return (v)=> (v/100) * (pxExtra/2);
}

function draw(){
  ctx.fillStyle = '#fff';
  ctx.fillRect(0,0,targetW,targetH);
  if(!img) { info.textContent = 'No image loaded.'; downloadBtn.disabled = true; return; }

  const scale = baseScale * zoom;
  const drawW = imgW * scale;
  const drawH = imgH * scale;

  const extraX = Math.max(0, drawW - targetW);
  const extraY = Math.max(0, drawH - targetH);

  const offX = -extraX/2 + sliderToOffset(extraX)(panX);
  const offY = -extraY/2 + sliderToOffset(extraY)(panY);

  ctx.imageSmoothingQuality = 'high';
  ctx.drawImage(img, offX, offY, drawW, drawH);

  const mime = formatSel.value;
  info.textContent = `Preset: ${targetW}×${targetH} — Zoom: ${zoom.toFixed(2)} — PanX:${panX} PanY:${panY} — Format: ${mime==='image/jpeg'?'JPG':'PNG'}`;
  downloadBtn.disabled = false;
}

function autoFit(){
  zoom = 1;
  panX = 0; panY = 0;
  zoomRange.value = zoom;
  panXRange.value = panX;
  panYRange.value = panY;
  updateBaseScale();
  draw();
}

fileInput.addEventListener('change', async ()=>{
  const file = fileInput.files[0];
  if(!file) return;
  if(imgURL) URL.revokeObjectURL(imgURL);
  imgURL = URL.createObjectURL(file);
  img = new Image();
  img.src = imgURL;
  await img.decode();
  imgW = img.naturalWidth; imgH = img.naturalHeight;
  parsePreset(); updateBaseScale(); autoFit();
});

presetSel.addEventListener('change', ()=>{ parsePreset(); updateBaseScale(); draw(); });
formatSel.addEventListener('change', draw);
zoomRange.addEventListener('input', ()=>{ zoom = parseFloat(zoomRange.value); draw(); });
panXRange.addEventListener('input', ()=>{ panX = parseInt(panXRange.value,10); draw(); });
panYRange.addEventListener('input', ()=>{ panY = parseInt(panYRange.value,10); draw(); });
fitBtn.addEventListener('click', autoFit);

downloadBtn.addEventListener('click', ()=>{
  const mime = formatSel.value;
  canvas.toBlob(b=>{
    const url = URL.createObjectURL(b);
    const a = document.createElement('a');
    const ext = mime==='image/jpeg' ? 'jpg' : 'png';
    a.href = url; a.download = `post-${targetW}x${targetH}.${ext}`;
    a.click();
    URL.revokeObjectURL(url);
  }, formatSel.value, 0.92);
});

// Initialize
parsePreset(); draw();
</script>
</body>
</html>
