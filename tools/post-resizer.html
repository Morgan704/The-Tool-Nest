<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Post Resizer — Nest</title><link rel="stylesheet" href="../assets/styles.css"/></head>
<body>
  <div class="tool-wrap" style="max-width:900px;margin:80px auto">
    <a href="../index.html">← Home</a>
    <h1>Post Image Resizer</h1>
    <p class="kv">Upload an image and pick preset (Instagram, Twitter, Facebook). Download resized image.</p>

    <input id="file" type="file" accept="image/*"/>
    <label class="kv">Preset</label>
    <select id="preset" class="input">
      <option value="1080x1080">Instagram (1080×1080)</option>
      <option value="1080x1920">Instagram Story (1080×1920)</option>
      <option value="1200x675">Twitter (1200×675)</option>
      <option value="1200x630">Facebook (1200×630)</option>
    </select>

    <div style="margin-top:8px"><button id="resize" class="btn btn-primary">Resize</button><button id="reset" class="btn btn-secondary">Reset</button></div>

    <div id="out" style="margin-top:12px"></div>
    <div style="margin-top:8px"><a id="dl" class="btn btn-primary" style="display:none">Download</a></div>
  </div>

<script>
const fileIn = document.getElementById('file'), preset = document.getElementById('preset'), resizeBtn=document.getElementById('resize'), resetBtn=document.getElementById('reset'), out=document.getElementById('out'), dl=document.getElementById('dl');
let curUrl='';

resetBtn.addEventListener('click', ()=>{ fileIn.value=''; out.innerHTML=''; dl.style.display='none'; if(curUrl){ URL.revokeObjectURL(curUrl); curUrl=''; } });

resizeBtn.addEventListener('click', async ()=>{
  const f = fileIn.files[0]; if(!f){ alert('Select an image'); return; }
  const dims = preset.value.split('x').map(n=>parseInt(n,10));
  const img = new Image(); const url = URL.createObjectURL(f); img.src=url; await img.decode();
  const canvas = document.createElement('canvas'); canvas.width = dims[0]; canvas.height = dims[1];
  const ctx = canvas.getContext('2d');
  // center-cover strategy
  const sw = img.width, sh = img.height, dw = canvas.width, dh = canvas.height;
  const srcRatio = sw/sh, destRatio = dw/dh;
  let sx=0, sy=0, sWidth=sw, sHeight=sh;
  if(srcRatio > destRatio){ // crop sides
    sWidth = Math.round(sh * destRatio); sx = Math.round((sw - sWidth)/2);
  } else { // crop top/bottom
    sHeight = Math.round(sw / destRatio); sy = Math.round((sh - sHeight)/2);
  }
  ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, dw, dh);
  canvas.toBlob((b)=>{
    if(!b){ alert('Failed'); return; }
    if(curUrl) URL.revokeObjectURL(curUrl);
    curUrl = URL.createObjectURL(b);
    out.innerHTML = `<img src="${curUrl}" style="max-width:360px;border-radius:8px" alt="resized">`;
    dl.href = curUrl; dl.download = `resized.png`; dl.style.display = 'inline-block';
  }, 'image/png', 0.94);
  URL.revokeObjectURL(url);
});
</script>
</body></html>
