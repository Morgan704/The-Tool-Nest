<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Password Generator</title>
    <meta name="description" content="Generate secure, customizable passwords with advanced options and strength analysis">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Secure Password Generator&quot;,&quot;short_name&quot;:&quot;PassGen&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;theme_color&quot;:&quot;#3B82F6&quot;}">
    <style>
        .strength-bar {
            transition: all 0.3s ease;
        }
        .copy-feedback {
            animation: copyPulse 0.6s ease-in-out;
        }
        @keyframes copyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s;
        }
        .tooltip-trigger:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .dark .dark\:bg-gray-900 { background-color: #111827; }
        .dark .dark\:bg-gray-800 { background-color: #1f2937; }
        .dark .dark\:bg-gray-700 { background-color: #374151; }
        .dark .dark\:text-white { color: #ffffff; }
        .dark .dark\:text-gray-300 { color: #d1d5db; }
        .dark .dark\:border-gray-600 { border-color: #4b5563; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">
                    <i class="fas fa-shield-alt text-blue-600 mr-3"></i>
                    Secure Password Generator
                </h1>
                <p class="text-gray-600 dark:text-gray-300">Generate cryptographically secure passwords with advanced customization</p>
                
                <!-- Theme Toggle -->
                <button id="themeToggle" class="mt-4 px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                    <span class="ml-2">Toggle Theme</span>
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Generator -->
                <div class="lg:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">Password Generator</h2>
                        
                        <!-- Generated Password Display -->
                        <div class="mb-6">
                            <div class="flex items-center mb-2">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Generated Password</label>
                                <div class="tooltip-trigger relative ml-2">
                                    <i class="fas fa-info-circle text-gray-400 cursor-help"></i>
                                    <div class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg">
                                        Click the copy button or press Ctrl+C to copy
                                    </div>
                                </div>
                            </div>
                            <div class="relative">
                                <input type="text" id="generatedPassword" readonly 
                                    class="w-full px-4 py-3 pr-12 text-lg font-mono bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white"
                                    placeholder="Click 'Generate Password' to create a secure password">
                                <button id="copyBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-blue-600 transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            
                            <!-- Password Strength Indicator -->
                            <div class="mt-3">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Strength: <span id="strengthText">-</span></span>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">Entropy: <span id="entropyText">0</span> bits</span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                                    <div id="strengthBar" class="strength-bar h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <div class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                                    Estimated crack time: <span id="crackTime">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Generation Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Password Length -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Password Length: <span id="lengthValue">16</span>
                                </label>
                                <input type="range" id="passwordLength" min="4" max="128" value="16" 
                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <!-- Generation Type -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Generation Type</label>
                                <select id="generationType" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white">
                                    <option value="random">Random Password</option>
                                    <option value="pronounceable">Pronounceable</option>
                                    <option value="passphrase">Passphrase</option>
                                </select>
                            </div>
                        </div>

                        <!-- Character Sets -->
                        <div class="mb-6" id="characterSets">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Character Sets</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="uppercase" checked class="rounded text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">A-Z</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="lowercase" checked class="rounded text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">a-z</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="numbers" checked class="rounded text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">0-9</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="symbols" checked class="rounded text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">!@#$%</span>
                                </label>
                            </div>
                            
                            <!-- Advanced Options -->
                            <div class="mt-4 space-y-3">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="excludeSimilar" class="rounded text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">Exclude similar characters (0, O, l, 1, I)</span>
                                </label>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Custom Symbols</label>
                                    <input type="text" id="customSymbols" placeholder="Enter custom symbols..." 
                                        class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white">
                                </div>
                            </div>
                        </div>

                        <!-- Passphrase Options -->
                        <div class="mb-6 hidden" id="passphraseOptions">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Passphrase Options</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Number of Words</label>
                                    <input type="number" id="wordCount" min="3" max="10" value="4" 
                                        class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Separator</label>
                                    <input type="text" id="wordSeparator" value="-" maxlength="3"
                                        class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white">
                                </div>
                            </div>
                            <label class="flex items-center space-x-2 mt-3">
                                <input type="checkbox" id="capitalizeWords" class="rounded text-blue-600">
                                <span class="text-gray-700 dark:text-gray-300">Capitalize first letter of each word</span>
                            </label>
                        </div>

                        <!-- Generate Button -->
                        <div class="flex flex-wrap gap-3">
                            <button id="generateBtn" class="flex-1 min-w-40 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                                <i class="fas fa-magic mr-2"></i>Generate Password
                            </button>
                            <button id="batchGenerateBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                                <i class="fas fa-list mr-2"></i>Batch Generate
                            </button>
                        </div>
                    </div>

                    <!-- Batch Generation -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hidden" id="batchSection">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Batch Password Generation</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Number of passwords (1-50): <span id="batchCountValue">10</span>
                            </label>
                            <input type="range" id="batchCount" min="1" max="50" value="10" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div class="flex gap-3 mb-4">
                            <button id="generateBatchBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-magic mr-2"></i>Generate Batch
                            </button>
                            <button id="exportBatchBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors" disabled>
                                <i class="fas fa-download mr-2"></i>Export to File
                            </button>
                            <button id="clearBatchBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-trash mr-2"></i>Clear
                            </button>
                        </div>

                        <div id="batchResults" class="space-y-2 max-h-96 overflow-y-auto"></div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Password History -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Password History</h3>
                            <button id="clearHistoryBtn" class="text-gray-500 hover:text-red-600 transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div id="passwordHistory" class="space-y-2 max-h-64 overflow-y-auto">
                            <p class="text-gray-500 dark:text-gray-400 text-sm italic">No passwords generated yet</p>
                        </div>
                    </div>

                    <!-- Security Tips -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Security Tips
                        </h3>
                        <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check-circle text-green-500 mt-0.5"></i>
                                <p>Use unique passwords for each account</p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check-circle text-green-500 mt-0.5"></i>
                                <p>Enable two-factor authentication when available</p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check-circle text-green-500 mt-0.5"></i>
                                <p>Use a password manager to store passwords securely</p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check-circle text-green-500 mt-0.5"></i>
                                <p>Longer passwords are generally more secure</p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mt-0.5"></i>
                                <p>Never share passwords or write them down</p>
                            </div>
                        </div>
                    </div>

                    <!-- Keyboard Shortcuts -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-keyboard text-blue-500 mr-2"></i>Shortcuts
                        </h3>
                        <div class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
                            <div class="flex justify-between">
                                <span>Generate Password</span>
                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+G</kbd>
                            </div>
                            <div class="flex justify-between">
                                <span>Copy Password</span>
                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+C</kbd>
                            </div>
                            <div class="flex justify-between">
                                <span>Toggle Theme</span>
                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+T</kbd>
                            </div>
                            <div class="flex justify-between">
                                <span>Batch Generate</span>
                                <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+B</kbd>
                            </div>
                        </div>
                    </div>

                    <!-- Password Strength Guide -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-chart-line text-purple-500 mr-2"></i>Strength Guide
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-2 bg-red-500 rounded"></div>
                                <span class="text-sm text-gray-600 dark:text-gray-300">Weak (0-25 bits)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-2 bg-yellow-500 rounded"></div>
                                <span class="text-sm text-gray-600 dark:text-gray-300">Fair (26-50 bits)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-2 bg-blue-500 rounded"></div>
                                <span class="text-sm text-gray-600 dark:text-gray-300">Good (51-75 bits)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-2 bg-green-500 rounded"></div>
                                <span class="text-sm text-gray-600 dark:text-gray-300">Strong (76+ bits)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SecurePasswordGenerator {
            constructor() {
                this.initializeElements();
                this.initializeEventListeners();
                this.initializeKeyboardShortcuts();
                this.initializeTheme();
                this.passwordHistory = [];
                this.wordList = [
                    'abandon', 'ability', 'absent', 'absorb', 'abstract', 'absurd', 'abuse', 'access',
                    'accident', 'account', 'accuse', 'achieve', 'acid', 'acoustic', 'acquire', 'across',
                    'action', 'actor', 'actual', 'adapt', 'address', 'adjust', 'admit', 'adult',
                    'advance', 'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'agent',
                    'agree', 'ahead', 'airport', 'aisle', 'alarm', 'album', 'alcohol', 'alert',
                    'alien', 'alive', 'almost', 'alone', 'alpha', 'already', 'also', 'alter',
                    'always', 'amateur', 'amazing', 'among', 'amount', 'amused', 'analyst', 'anchor',
                    'ancient', 'anger', 'angle', 'angry', 'animal', 'ankle', 'announce', 'annual',
                    'another', 'answer', 'antenna', 'antique', 'anxiety', 'any', 'apart', 'apology',
                    'appear', 'apple', 'approve', 'april', 'arcade', 'arch', 'arctic', 'area',
                    'arena', 'argue', 'armed', 'armor', 'army', 'around', 'arrange', 'arrest',
                    'arrive', 'arrow', 'artist', 'artwork', 'ask', 'aspect', 'assault', 'asset',
                    'assist', 'assume', 'asthma', 'athlete', 'atom', 'attack', 'attend', 'attitude',
                    'attract', 'auction', 'audit', 'august', 'aunt', 'author', 'auto', 'autumn',
                    'average', 'avocado', 'avoid', 'awake', 'aware', 'away', 'awesome', 'awful',
                    'awkward', 'axis', 'baby', 'bachelor', 'bacon', 'badge', 'bag', 'balance',
                    'balcony', 'ball', 'bamboo', 'banana', 'banner', 'bar', 'barely', 'bargain',
                    'barrel', 'base', 'basic', 'basket', 'battle', 'beach', 'bean', 'beauty',
                    'because', 'become', 'beef', 'before', 'begin', 'behave', 'behind', 'believe',
                    'below', 'belt', 'bench', 'benefit', 'best', 'betray', 'better', 'between'
                ];
            }

            initializeElements() {
                this.elements = {
                    generatedPassword: document.getElementById('generatedPassword'),
                    copyBtn: document.getElementById('copyBtn'),
                    generateBtn: document.getElementById('generateBtn'),
                    batchGenerateBtn: document.getElementById('batchGenerateBtn'),
                    passwordLength: document.getElementById('passwordLength'),
                    lengthValue: document.getElementById('lengthValue'),
                    generationType: document.getElementById('generationType'),
                    characterSets: document.getElementById('characterSets'),
                    passphraseOptions: document.getElementById('passphraseOptions'),
                    batchSection: document.getElementById('batchSection'),
                    batchCount: document.getElementById('batchCount'),
                    batchCountValue: document.getElementById('batchCountValue'),
                    generateBatchBtn: document.getElementById('generateBatchBtn'),
                    exportBatchBtn: document.getElementById('exportBatchBtn'),
                    clearBatchBtn: document.getElementById('clearBatchBtn'),
                    batchResults: document.getElementById('batchResults'),
                    passwordHistory: document.getElementById('passwordHistory'),
                    clearHistoryBtn: document.getElementById('clearHistoryBtn'),
                    strengthBar: document.getElementById('strengthBar'),
                    strengthText: document.getElementById('strengthText'),
                    entropyText: document.getElementById('entropyText'),
                    crackTime: document.getElementById('crackTime'),
                    themeToggle: document.getElementById('themeToggle'),
                    uppercase: document.getElementById('uppercase'),
                    lowercase: document.getElementById('lowercase'),
                    numbers: document.getElementById('numbers'),
                    symbols: document.getElementById('symbols'),
                    excludeSimilar: document.getElementById('excludeSimilar'),
                    customSymbols: document.getElementById('customSymbols'),
                    wordCount: document.getElementById('wordCount'),
                    wordSeparator: document.getElementById('wordSeparator'),
                    capitalizeWords: document.getElementById('capitalizeWords')
                };
            }

            initializeEventListeners() {
                this.elements.generateBtn.addEventListener('click', () => this.generatePassword());
                this.elements.copyBtn.addEventListener('click', () => this.copyToClipboard());
                this.elements.passwordLength.addEventListener('input', () => {
                    this.elements.lengthValue.textContent = this.elements.passwordLength.value;
                });
                this.elements.batchCount.addEventListener('input', () => {
                    this.elements.batchCountValue.textContent = this.elements.batchCount.value;
                });
                this.elements.generationType.addEventListener('change', () => this.toggleGenerationType());
                this.elements.batchGenerateBtn.addEventListener('click', () => this.toggleBatchSection());
                this.elements.generateBatchBtn.addEventListener('click', () => this.generateBatch());
                this.elements.exportBatchBtn.addEventListener('click', () => this.exportBatch());
                this.elements.clearBatchBtn.addEventListener('click', () => this.clearBatch());
                this.elements.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
                this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());

                // Character set validation
                [this.elements.uppercase, this.elements.lowercase, this.elements.numbers, this.elements.symbols].forEach(checkbox => {
                    checkbox.addEventListener('change', () => this.validateCharacterSets());
                });
            }

            initializeKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key.toLowerCase()) {
                            case 'g':
                                e.preventDefault();
                                this.generatePassword();
                                break;
                            case 'c':
                                if (document.activeElement === this.elements.generatedPassword) {
                                    e.preventDefault();
                                    this.copyToClipboard();
                                }
                                break;
                            case 't':
                                e.preventDefault();
                                this.toggleTheme();
                                break;
                            case 'b':
                                e.preventDefault();
                                this.toggleBatchSection();
                                break;
                        }
                    }
                });
            }

            initializeTheme() {
                const savedTheme = localStorage.getItem('passwordGeneratorTheme') || 'light';
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                }
            }

            async getSecureRandom(max) {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] % max;
            }

            async getSecureRandomArray(length, max) {
                const array = new Uint32Array(length);
                window.crypto.getRandomValues(array);
                return Array.from(array, x => x % max);
            }

            getCharacterSets() {
                let charset = '';
                const customSymbols = this.elements.customSymbols.value;
                
                if (this.elements.uppercase.checked) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                if (this.elements.lowercase.checked) charset += 'abcdefghijklmnopqrstuvwxyz';
                if (this.elements.numbers.checked) charset += '0123456789';
                if (this.elements.symbols.checked) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
                if (customSymbols) charset += customSymbols;

                if (this.elements.excludeSimilar.checked) {
                    charset = charset.replace(/[0Ol1I]/g, '');
                }

                return charset;
            }

            async generateRandomPassword(length) {
                const charset = this.getCharacterSets();
                if (charset.length === 0) return '';

                const randomIndices = await this.getSecureRandomArray(length, charset.length);
                return randomIndices.map(index => charset[index]).join('');
            }

            async generatePronounceablePassword(length) {
                const vowels = 'aeiou';
                const consonants = 'bcdfghjklmnpqrstvwxyz';
                let password = '';
                
                for (let i = 0; i < length; i++) {
                    const useVowel = i % 2 === 1;
                    const chars = useVowel ? vowels : consonants;
                    const randomIndex = await this.getSecureRandom(chars.length);
                    password += chars[randomIndex];
                }

                // Add numbers and symbols if selected
                if (this.elements.numbers.checked || this.elements.symbols.checked) {
                    let additionalChars = '';
                    if (this.elements.numbers.checked) additionalChars += '0123456789';
                    if (this.elements.symbols.checked) additionalChars += '!@#$%&*';

                    if (additionalChars.length > 0) {
                        const numAdditional = Math.min(3, Math.floor(length * 0.2));
                        for (let i = 0; i < numAdditional; i++) {
                            const randomIndex = await this.getSecureRandom(additionalChars.length);
                            const insertIndex = await this.getSecureRandom(password.length);
                            password = password.slice(0, insertIndex) + additionalChars[randomIndex] + password.slice(insertIndex);
                        }
                    }
                }

                return password.substring(0, length);
            }

            async generatePassphrase() {
                const wordCount = parseInt(this.elements.wordCount.value);
                const separator = this.elements.wordSeparator.value;
                const capitalize = this.elements.capitalizeWords.checked;

                const selectedWords = [];
                for (let i = 0; i < wordCount; i++) {
                    const randomIndex = await this.getSecureRandom(this.wordList.length);
                    let word = this.wordList[randomIndex];
                    if (capitalize) {
                        word = word.charAt(0).toUpperCase() + word.slice(1);
                    }
                    selectedWords.push(word);
                }

                return selectedWords.join(separator);
            }

            async generatePassword() {
                const type = this.elements.generationType.value;
                const length = parseInt(this.elements.passwordLength.value);
                let password = '';

                try {
                    switch (type) {
                        case 'random':
                            password = await this.generateRandomPassword(length);
                            break;
                        case 'pronounceable':
                            password = await this.generatePronounceablePassword(length);
                            break;
                        case 'passphrase':
                            password = await this.generatePassphrase();
                            break;
                    }

                    if (password) {
                        this.elements.generatedPassword.value = password;
                        this.analyzePassword(password);
                        this.addToHistory(password);
                    }
                } catch (error) {
                    console.error('Error generating password:', error);
                    alert('Error generating password. Please try again.');
                }
            }

            analyzePassword(password) {
                const entropy = this.calculateEntropy(password);
                const strength = this.getPasswordStrength(entropy);
                const crackTime = this.estimateCrackTime(entropy);

                this.elements.entropyText.textContent = entropy.toFixed(1);
                this.elements.strengthText.textContent = strength.text;
                this.elements.crackTime.textContent = crackTime;

                // Update strength bar
                this.elements.strengthBar.style.width = `${strength.percentage}%`;
                this.elements.strengthBar.className = `strength-bar h-3 rounded-full transition-all duration-300 ${strength.color}`;
            }

            calculateEntropy(password) {
                let poolSize = 0;
                
                if (/[a-z]/.test(password)) poolSize += 26;
                if (/[A-Z]/.test(password)) poolSize += 26;
                if (/[0-9]/.test(password)) poolSize += 10;
                if (/[^a-zA-Z0-9]/.test(password)) poolSize += 32;

                return password.length * Math.log2(poolSize);
            }

            getPasswordStrength(entropy) {
                if (entropy < 26) return { text: 'Very Weak', percentage: 20, color: 'bg-red-500' };
                if (entropy < 36) return { text: 'Weak', percentage: 40, color: 'bg-orange-500' };
                if (entropy < 51) return { text: 'Fair', percentage: 60, color: 'bg-yellow-500' };
                if (entropy < 76) return { text: 'Good', percentage: 80, color: 'bg-blue-500' };
                return { text: 'Strong', percentage: 100, color: 'bg-green-500' };
            }

            estimateCrackTime(entropy) {
                const guessesPerSecond = 1e9; // 1 billion guesses per second
                const possiblePasswords = Math.pow(2, entropy);
                const secondsToCrack = possiblePasswords / (2 * guessesPerSecond);

                if (secondsToCrack < 60) return 'Instant';
                if (secondsToCrack < 3600) return `${Math.round(secondsToCrack / 60)} minutes`;
                if (secondsToCrack < 86400) return `${Math.round(secondsToCrack / 3600)} hours`;
                if (secondsToCrack < 2592000) return `${Math.round(secondsToCrack / 86400)} days`;
                if (secondsToCrack < 31536000) return `${Math.round(secondsToCrack / 2592000)} months`;
                if (secondsToCrack < 315360000000) return `${Math.round(secondsToCrack / 31536000)} years`;
                return 'Millions of years';
            }

            async copyToClipboard() {
                const password = this.elements.generatedPassword.value;
                if (!password) return;

                try {
                    await navigator.clipboard.writeText(password);
                    this.showCopyFeedback();
                } catch (error) {
                    // Fallback for older browsers
                    this.elements.generatedPassword.select();
                    document.execCommand('copy');
                    this.showCopyFeedback();
                }
            }

            showCopyFeedback() {
                this.elements.copyBtn.innerHTML = '<i class="fas fa-check text-green-600"></i>';
                this.elements.copyBtn.classList.add('copy-feedback');
                
                setTimeout(() => {
                    this.elements.copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    this.elements.copyBtn.classList.remove('copy-feedback');
                }, 2000);
            }

            addToHistory(password) {
                const historyItem = {
                    password,
                    timestamp: new Date().toLocaleString(),
                    strength: this.elements.strengthText.textContent
                };

                this.passwordHistory.unshift(historyItem);
                if (this.passwordHistory.length > 10) {
                    this.passwordHistory.pop();
                }

                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                if (this.passwordHistory.length === 0) {
                    this.elements.passwordHistory.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm italic">No passwords generated yet</p>';
                    return;
                }

                this.elements.passwordHistory.innerHTML = this.passwordHistory
                    .map((item, index) => `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
                             onclick="passwordGenerator.copyPasswordFromHistory('${item.password}')">
                            <div class="font-mono text-sm text-gray-900 dark:text-white truncate">${item.password}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">${item.timestamp} • ${item.strength}</div>
                        </div>
                    `).join('');
            }

            async copyPasswordFromHistory(password) {
                try {
                    await navigator.clipboard.writeText(password);
                    // Show temporary feedback
                    const historyItems = this.elements.passwordHistory.querySelectorAll('div');
                    historyItems.forEach(item => {
                        if (item.textContent.includes(password)) {
                            const originalBg = item.className;
                            item.classList.add('bg-green-100', 'dark:bg-green-800');
                            setTimeout(() => {
                                item.className = originalBg;
                            }, 1000);
                        }
                    });
                } catch (error) {
                    console.error('Failed to copy password:', error);
                }
            }

            clearHistory() {
                this.passwordHistory = [];
                this.updateHistoryDisplay();
            }

            toggleGenerationType() {
                const type = this.elements.generationType.value;
                
                if (type === 'passphrase') {
                    this.elements.characterSets.classList.add('hidden');
                    this.elements.passphraseOptions.classList.remove('hidden');
                } else {
                    this.elements.characterSets.classList.remove('hidden');
                    this.elements.passphraseOptions.classList.add('hidden');
                }
            }

            validateCharacterSets() {
                const anyChecked = this.elements.uppercase.checked || 
                                 this.elements.lowercase.checked || 
                                 this.elements.numbers.checked || 
                                 this.elements.symbols.checked;
                
                this.elements.generateBtn.disabled = !anyChecked;
                
                if (!anyChecked) {
                    this.elements.generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    this.elements.generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            toggleBatchSection() {
                this.elements.batchSection.classList.toggle('hidden');
                
                if (!this.elements.batchSection.classList.contains('hidden')) {
                    this.elements.batchGenerateBtn.scrollIntoView({ behavior: 'smooth' });
                }
            }

            async generateBatch() {
                const count = parseInt(this.elements.batchCount.value);
                const passwords = [];

                this.elements.generateBatchBtn.disabled = true;
                this.elements.generateBatchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';

                for (let i = 0; i < count; i++) {
                    await this.generatePassword();
                    const password = this.elements.generatedPassword.value;
                    if (password) {
                        passwords.push({
                            password,
                            strength: this.elements.strengthText.textContent,
                            entropy: this.elements.entropyText.textContent
                        });
                    }
                }

                this.displayBatchResults(passwords);
                this.elements.exportBatchBtn.disabled = passwords.length === 0;
                this.batchPasswords = passwords;

                this.elements.generateBatchBtn.disabled = false;
                this.elements.generateBatchBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Batch';
            }

            displayBatchResults(passwords) {
                this.elements.batchResults.innerHTML = passwords
                    .map((item, index) => `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <span class="font-mono text-sm text-gray-900 dark:text-white truncate flex-1 mr-2">${item.password}</span>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">${item.strength}</span>
                                    <button onclick="passwordGenerator.copyPasswordFromBatch('${item.password}')" 
                                            class="text-gray-500 hover:text-blue-600 transition-colors">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
            }

            async copyPasswordFromBatch(password) {
                try {
                    await navigator.clipboard.writeText(password);
                    // Visual feedback similar to history
                } catch (error) {
                    console.error('Failed to copy password:', error);
                }
            }

            exportBatch() {
                if (!this.batchPasswords || this.batchPasswords.length === 0) return;

                const content = [
                    'Generated Passwords - ' + new Date().toLocaleString(),
                    '='.repeat(50),
                    '',
                    ...this.batchPasswords.map((item, index) => 
                        `${index + 1}. ${item.password} (Strength: ${item.strength}, Entropy: ${item.entropy} bits)`
                    ),
                    '',
                    'Generated with Secure Password Generator',
                    'Remember to store these passwords securely!'
                ].join('\n');

                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `passwords_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            clearBatch() {
                this.elements.batchResults.innerHTML = '';
                this.elements.exportBatchBtn.disabled = true;
                this.batchPasswords = [];
            }

            toggleTheme() {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('passwordGeneratorTheme', isDark ? 'dark' : 'light');
            }
        }

        // Initialize the password generator
        const passwordGenerator = new SecurePasswordGenerator();

        // Generate initial password
        passwordGenerator.generatePassword();

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,const CACHE_NAME="password-generator-v1";self.addEventListener("install",event=>{event.waitUntil(caches.open(CACHE_NAME))});self.addEventListener("fetch",event=>{event.respondWith(caches.match(event.request).then(response=>{return response||fetch(event.request)}))});');
        }
    </script>
</body>
</html>
