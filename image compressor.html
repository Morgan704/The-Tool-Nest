<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
        }
        .progress-bar {
            width: 0%;
            transition: width 0.3s ease;
        }
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                <i class="fas fa-compress-alt text-blue-600"></i>
                Image Compressor Tool
            </h1>
            <p class="text-gray-600">Compress your images without losing quality • Client-side processing • No upload required</p>
        </header>

        <!-- Upload Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="drop-zone rounded-lg p-8 text-center cursor-pointer" id="dropZone">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                <p class="text-lg text-gray-600 mb-2">Drag & drop your images here</p>
                <p class="text-sm text-gray-500 mb-4">or click to browse files</p>
                <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-folder-open mr-2"></i>Choose Files
                </button>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8" id="settingsPanel" style="display: none;">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-cog mr-2"></i>Compression Settings
            </h3>
            <div class="grid md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Quality</label>
                    <input type="range" id="qualitySlider" min="10" max="100" value="80" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Low (10%)</span>
                        <span id="qualityValue" class="font-medium">80%</span>
                        <span>High (100%)</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Output Format</label>
                    <select id="formatSelect" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                        <option value="webp">WebP</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Max Width (px)</label>
                    <input type="number" id="maxWidth" placeholder="Original" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
            <div class="mt-6 flex flex-wrap gap-4">
                <button onclick="compressAll()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-compress mr-2"></i>Compress All
                </button>
                <button onclick="downloadAll()" id="downloadAllBtn" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors" style="display: none;">
                    <i class="fas fa-download mr-2"></i>Download All
                </button>
                <button onclick="clearAll()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
                    <i class="fas fa-trash mr-2"></i>Clear All
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-8" id="progressContainer" style="display: none;">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700">Processing...</span>
                <span class="text-sm text-gray-500" id="progressText">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-blue-600 h-2 rounded-full progress-bar" id="progressBar"></div>
            </div>
        </div>

        <!-- Images Grid -->
        <div id="imagesGrid" class="grid gap-6"></div>
    </div>

    <script>
        let selectedFiles = [];
        let processedImages = [];

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const qualitySlider = document.getElementById('qualitySlider');

            // Drag and drop events
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            dropZone.addEventListener('click', () => fileInput.click());

            // File input change
            fileInput.addEventListener('change', handleFileSelect);

            // Quality slider
            qualitySlider.addEventListener('input', function() {
                document.getElementById('qualityValue').textContent = this.value + '%';
            });
        });

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;

            selectedFiles = [...selectedFiles, ...files];
            document.getElementById('settingsPanel').style.display = 'block';
            displayImages();
        }

        function displayImages() {
            const grid = document.getElementById('imagesGrid');
            grid.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const imageCard = createImageCard(file, index);
                grid.appendChild(imageCard);
            });
        }

        function createImageCard(file, index) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-lg p-6';
            card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h4 class="font-semibold text-gray-800 truncate mr-4">${file.name}</h4>
                    <button onclick="removeImage(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="comparison-container mb-4">
                    <div class="text-center">
                        <p class="text-sm font-medium text-gray-700 mb-2">Original</p>
                        <img id="original-${index}" class="image-preview mx-auto rounded border" alt="Original">
                        <p class="text-xs text-gray-500 mt-2">Size: ${formatFileSize(file.size)}</p>
                    </div>
                    <div class="text-center" id="compressed-container-${index}" style="display: none;">
                        <p class="text-sm font-medium text-gray-700 mb-2">Compressed</p>
                        <img id="compressed-${index}" class="image-preview mx-auto rounded border" alt="Compressed">
                        <p class="text-xs text-gray-500 mt-2" id="compressed-size-${index}"></p>
                        <button onclick="downloadImage(${index})" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">
                            <i class="fas fa-download mr-1"></i>Download
                        </button>
                    </div>
                </div>
                <div class="flex justify-center">
                    <button onclick="compressImage(${index})" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        <i class="fas fa-compress mr-2"></i>Compress
                    </button>
                </div>
            `;

            // Load and display original image
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById(`original-${index}`);
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            return card;
        }

        function removeImage(index) {
            selectedFiles.splice(index, 1);
            processedImages.splice(index, 1);
            
            if (selectedFiles.length === 0) {
                document.getElementById('settingsPanel').style.display = 'none';
                document.getElementById('imagesGrid').innerHTML = '';
            } else {
                displayImages();
            }
        }

        function compressImage(index) {
            const file = selectedFiles[index];
            const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
            const format = document.getElementById('formatSelect').value;
            const maxWidth = parseInt(document.getElementById('maxWidth').value) || null;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    // Calculate new dimensions
                    let { width, height } = img;
                    if (maxWidth && width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);

                    const mimeType = format === 'png' ? 'image/png' : 
                                   format === 'webp' ? 'image/webp' : 'image/jpeg';
                    
                    canvas.toBlob(function(blob) {
                        processedImages[index] = {
                            blob: blob,
                            filename: changeFileExtension(file.name, format),
                            originalSize: file.size,
                            compressedSize: blob.size
                        };

                        // Display compressed image
                        const url = URL.createObjectURL(blob);
                        const compressedImg = document.getElementById(`compressed-${index}`);
                        compressedImg.src = url;

                        const container = document.getElementById(`compressed-container-${index}`);
                        container.style.display = 'block';

                        const sizeElement = document.getElementById(`compressed-size-${index}`);
                        const savings = ((file.size - blob.size) / file.size * 100).toFixed(1);
                        sizeElement.innerHTML = `Size: ${formatFileSize(blob.size)}<br><span class="text-green-600">Saved: ${savings}%</span>`;

                        // Show download all button if any image is processed
                        document.getElementById('downloadAllBtn').style.display = 'inline-block';
                    }, mimeType, quality);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function compressAll() {
            if (selectedFiles.length === 0) return;

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            progressContainer.style.display = 'block';
            let completed = 0;

            selectedFiles.forEach((file, index) => {
                setTimeout(() => {
                    compressImage(index);
                    completed++;
                    const percentage = (completed / selectedFiles.length * 100).toFixed(0);
                    progressBar.style.width = percentage + '%';
                    progressText.textContent = percentage + '%';

                    if (completed === selectedFiles.length) {
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 1000);
                    }
                }, index * 200); // Stagger the compression
            });
        }

        function downloadImage(index) {
            const processed = processedImages[index];
            if (!processed) return;

            const url = URL.createObjectURL(processed.blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = processed.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadAll() {
            processedImages.forEach((processed, index) => {
                if (processed) {
                    setTimeout(() => downloadImage(index), index * 500);
                }
            });
        }

        function clearAll() {
            selectedFiles = [];
            processedImages = [];
            document.getElementById('settingsPanel').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('downloadAllBtn').style.display = 'none';
            document.getElementById('imagesGrid').innerHTML = '';
            document.getElementById('fileInput').value = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function changeFileExtension(filename, newExtension) {
            const lastDotIndex = filename.lastIndexOf('.');
            if (lastDotIndex === -1) return filename + '.' + newExtension;
            return filename.substring(0, lastDotIndex) + '.' + newExtension;
        }
    </script>
</body>
</html>
