<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Background Remover</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<style>
  body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
  .glass-effect { backdrop-filter: blur(10px); background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius:1rem; }
  .upload-area { border:3px dashed #cbd5e0; min-height:200px; transition:0.3s; cursor:pointer; display:flex; flex-direction:column; justify-content:center; align-items:center; }
  .upload-area.dragover { border-color:#4299e1; background-color:rgba(66,153,225,0.1); }
  .method-btn { background: rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; padding:1rem; border-radius:.5rem; text-align:center; cursor:pointer; transition:0.3s; }
  .method-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); }
  .method-active { background: linear-gradient(135deg,#667eea,#764ba2); color:white; }
  .method-section { display:none; }
  .checkerboard-bg { background-image: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%); background-size:20px 20px; background-position:0 0,0 10px,10px -10px,-10px 0px; }
</style>
</head>
<body class="p-6">
<div class="container mx-auto">

  <div class="text-center mb-6 text-white">
    <h1 class="text-4xl font-bold mb-2"><i class="fas fa-magic mr-2"></i>Professional Background Remover</h1>
    <p>Choose a method below:</p>
  </div>

  <!-- Method Selection -->
  <div class="flex gap-4 mb-6">
    <div class="method-btn method-active" data-method="client">Client-Side AI</div>
    <div class="method-btn" data-method="manual">Manual Editor</div>
    <div class="method-btn" data-method="comparison">Compare</div>
  </div>

  <!-- Upload Section -->
  <div class="glass-effect p-6 mb-6">
    <div id="uploadArea" class="upload-area">
      <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-3"></i>
      <p>Drag & drop your image here or click to select</p>
      <input type="file" id="fileInput" class="hidden" accept="image/*">
    </div>
  </div>

  <!-- Client-Side AI Section -->
  <div id="clientSection" class="method-section" style="display:block;">
    <div class="glass-effect p-4 mb-6">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="text-white font-semibold mb-2">Original Image</h3>
          <canvas id="originalCanvas" class="w-full border rounded max-h-64"></canvas>
        </div>
        <div>
          <h3 class="text-white font-semibold mb-2">Processed Image</h3>
          <canvas id="processedCanvas" class="w-full border rounded max-h-64"></canvas>
        </div>
      </div>
      <div class="mt-4 flex gap-2">
        <button id="processBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"><i class="fas fa-magic mr-1"></i>Process</button>
        <button id="downloadBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"><i class="fas fa-download mr-1"></i>Download</button>
      </div>
    </div>
  </div>

  <!-- Manual Editor Section -->
  <div id="manualSection" class="method-section">
    <div class="glass-effect p-4 mb-6">
      <h3 class="text-white font-semibold mb-2">Manual Editing</h3>
      <div class="relative">
        <canvas id="manualCanvas" class="border rounded max-h-64"></canvas>
        <canvas id="maskCanvas" class="absolute top-0 left-0 border rounded max-h-64"></canvas>
      </div>
      <div class="mt-2 flex gap-2">
        <label class="text-white">Brush:</label>
        <input type="range" id="brushSize" min="1" max="50" value="10">
        <select id="brushMode">
          <option value="erase">Erase Background</option>
          <option value="keep">Keep Foreground</option>
        </select>
        <button id="applyMask" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded">Apply</button>
        <button id="downloadManual" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded">Download</button>
      </div>
    </div>
  </div>

  <!-- Comparison Section -->
  <div id="comparisonSection" class="method-section">
    <div class="glass-effect p-4 mb-6">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="text-white mb-1">Before</h3>
          <div class="checkerboard-bg">
            <img id="beforeImage" class="w-full max-h-64 object-contain">
          </div>
        </div>
        <div>
          <h3 class="text-white mb-1">After</h3>
          <div class="checkerboard-bg">
            <img id="afterImage" class="w-full max-h-64 object-contain">
          </div>
        </div>
      </div>
      <button id="switchBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 mt-2 rounded"><i class="fas fa-exchange-alt mr-1"></i>Switch</button>
    </div>
  </div>

</div>

<script>
class BackgroundRemover {
  constructor() {
    // Elements
    this.uploadArea = document.getElementById('uploadArea');
    this.fileInput = document.getElementById('fileInput');
    this.originalCanvas = document.getElementById('originalCanvas');
    this.processedCanvas = document.getElementById('processedCanvas');
    this.manualCanvas = document.getElementById('manualCanvas');
    this.maskCanvas = document.getElementById('maskCanvas');
    this.beforeImage = document.getElementById('beforeImage');
    this.afterImage = document.getElementById('afterImage');

    this.processBtn = document.getElementById('processBtn');
    this.downloadBtn = document.getElementById('downloadBtn');
    this.applyMaskBtn = document.getElementById('applyMask');
    this.downloadManualBtn = document.getElementById('downloadManual');
    this.switchBtn = document.getElementById('switchBtn');
    this.brushSize = document.getElementById('brushSize');
    this.brushMode = document.getElementById('brushMode');

    this.methodBtns = document.querySelectorAll('.method-btn');
    this.sections = {
      client: document.getElementById('clientSection'),
      manual: document.getElementById('manualSection'),
      comparison: document.getElementById('comparisonSection')
    };

    this.currentImage = null;

    this.setupEvents();
    this.setupManualEditor();
  }

  setupEvents() {
    this.uploadArea.addEventListener('click', ()=>this.fileInput.click());
    this.fileInput.addEventListener('change', e=>this.loadFile(e.target.files[0]));
    this.uploadArea.addEventListener('dragover', e=>{ e.preventDefault(); this.uploadArea.classList.add('dragover'); });
    this.uploadArea.addEventListener('dragleave', e=>{ e.preventDefault(); this.uploadArea.classList.remove('dragover'); });
    this.uploadArea.addEventListener('drop', e=>{ e.preventDefault(); this.uploadArea.classList.remove('dragover'); this.loadFile(e.dataTransfer.files[0]); });

    this.methodBtns.forEach(btn => {
      btn.addEventListener('click', ()=>{
        this.methodBtns.forEach(b=>b.classList.remove('method-active'));
        btn.classList.add('method-active');
        for(let s in this.sections) this.sections[s].style.display='none';
        this.sections[btn.dataset.method].style.display='block';
      });
    });

    this.processBtn.addEventListener('click', ()=>this.processImage());
    this.downloadBtn.addEventListener('click', ()=>this.downloadCanvas(this.processedCanvas,'background_removed.png'));
    this.applyMaskBtn.addEventListener('click', ()=>this.applyMask());
    this.downloadManualBtn.addEventListener('click', ()=>this.downloadCanvas(this.manualCanvas,'manual_edit.png'));
    this.switchBtn.addEventListener('click', ()=>{ let t=this.beforeImage.src; this.beforeImage.src=this.afterImage.src; this.afterImage.src=t; });
  }

  loadFile(file) {
    if(!file || !file.type.startsWith('image/')) { alert('Please select an image.'); return; }
    const reader = new FileReader();
    reader.onload = e=>this.loadImage(e.target.result);
    reader.readAsDataURL(file);
  }

  loadImage(src) {
    const img = new Image();
    img.onload = ()=>{
      this.currentImage = img;
      this.drawCanvas(img,this.originalCanvas);
      this.drawCanvas(img,this.manualCanvas);
      this.maskCanvas.width=this.manualCanvas.width;
      this.maskCanvas.height=this.manualCanvas.height;
      this.beforeImage.src = src;
      this.afterImage.src = src;
    };
    img.src = src;
  }

  drawCanvas(img,canvas) {
    const ctx = canvas.getContext('2d');
    const maxW = 600, maxH = 400;
    let w=img.width, h=img.height;
    const ratio=Math.min(maxW/w,maxH/h);
    w*=ratio; h*=ratio;
    canvas.width=w; canvas.height=h;
    ctx.clearRect(0,0,w,h);
    ctx.drawImage(img,0,0,w,h);
  }

  processImage() {
    if(!this.currentImage){ alert('Select image first.'); return; }
    const srcCanvas = this.originalCanvas;
    const tgtCanvas = this.processedCanvas;
    tgtCanvas.width=srcCanvas.width;
    tgtCanvas.height=srcCanvas.height;
    const srcCtx = srcCanvas.getContext('2d');
    const tgtCtx = tgtCanvas.getContext('2d');
    const data = srcCtx.getImageData(0,0,srcCanvas.width,srcCanvas.height);
    const d=data.data;
    for(let i=0;i<d.length;i+=4){
      const r=d[i],g=d[i+1],b=d[i+2];
      const lum = 0.299*r+0.587*g+0.114*b;
      if(lum>200||(Math.abs(r-g)<30 && Math.abs(g-b)<30 && Math.abs(r-b)<30)){ d[i+3]=0; }
    }
    tgtCtx.putImageData(data,0,0);
    this.afterImage.src = tgtCanvas.toDataURL();
  }

  downloadCanvas(canvas,name){
    const link=document.createElement('a');
    link.download=name;
    link.href=canvas.toDataURL();
    link.click();
  }

  setupManualEditor() {
    let drawing=false, lastX=0, lastY=0;
    const ctx=this.maskCanvas.getContext('2d');
    const start=(e)=>{ drawing=true; [lastX,lastY]=this.getPos(e); };
    const draw=(e)=>{
      if(!drawing) return;
      const [x,y]=this.getPos(e);
      const size=parseInt(this.brushSize.value);
      const mode=this.brushMode.value;
      ctx.lineWidth=size; ctx.lineCap='round'; ctx.lineJoin='round';
      ctx.globalCompositeOperation = mode==='erase'?'source-over':'destination-out';
      ctx.strokeStyle = mode==='erase'?'rgba(255,0,0,0.5)':'rgba(0,0,0,1)';
      ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); ctx.stroke();
      [lastX,lastY]=[x,y];
    };
    const stop=()=>drawing=false;
    this.maskCanvas.addEventListener('mousedown',start);
    this.maskCanvas.addEventListener('mousemove',draw);
    this.maskCanvas.addEventListener('mouseup',stop);
    this.maskCanvas.addEventListener('mouseout',stop);
    this.maskCanvas.addEventListener('touchstart',e=>{ e.preventDefault(); const t=e.touches[0]; this.maskCanvas.dispatchEvent(new MouseEvent('mousedown',{clientX:t.clientX,clientY:t.clientY})); });
    this.maskCanvas.addEventListener('touchmove',e=>{ e.preventDefault(); const t=e.touches[0]; this.maskCanvas.dispatchEvent(new MouseEvent('mousemove',{clientX:t.clientX,clientY:t.clientY})); });
    this.maskCanvas.addEventListener('touchend',e=>{ e.preventDefault(); this.maskCanvas.dispatchEvent(new MouseEvent('mouseup',{})); });
  }

  getPos(e){
    const rect=this.maskCanvas.getBoundingClientRect();
    const scaleX=this.maskCanvas.width/rect.width;
    const scaleY=this.maskCanvas.height/rect.height;
    return [(e.clientX-rect.left)*scaleX,(e.clientY-rect.top)*scaleY];
  }

  applyMask() {
    if(!this.currentImage) return;
    const srcCtx = this.manualCanvas.getContext('2d');
    const maskCtx = this.maskCanvas.getContext('2d');
    const imgData = srcCtx.getImageData(0,0,this.manualCanvas.width,this.manualCanvas.height);
    const maskData = maskCtx.getImageData(0,0,this.maskCanvas.width,this.maskCanvas.height);
    const d=imgData.data, m=maskData.data;
    for(let i=0;i<d.length;i+=4){ if(m[i+3]>0 && m[i]>200) d[i+3]=0; }
    srcCtx.putImageData(imgData,0,0);
  }
}

document.addEventListener('DOMContentLoaded',()=>new BackgroundRemover());
</script>
</body>
</html>
